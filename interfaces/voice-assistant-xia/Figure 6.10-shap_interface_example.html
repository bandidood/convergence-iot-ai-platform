<!DOCTYPE html>
<html>
<head>
    <title>Interface SHAP Explicable - Exemple Utilisateur</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 30px; }
        .interface-demo { background: #2c3e50; color: white; border-radius: 12px; padding: 25px; margin: 20px 0; }
        .chat-container { max-height: 400px; overflow-y: auto; background: #34495e; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .message { margin: 15px 0; padding: 15px; border-radius: 12px; max-width: 80%; }
        .user-message { background: #3498db; margin-left: auto; text-align: right; }
        .ai-message { background: #27ae60; margin-right: auto; }
        .shap-explanation { background: #e8f4fd; color: #333; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .parameter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .parameter-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid; }
        .param-critical { border-color: #dc3545; }
        .param-warning { border-color: #ffc107; }
        .param-normal { border-color: #28a745; }
        .shap-value { font-size: 1.2em; font-weight: bold; margin: 5px 0; }
        .positive-impact { color: #28a745; }
        .negative-impact { color: #dc3545; }
        .chart-container { height: 300px; margin: 20px 0; }
        .feedback-section { background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .satisfaction-stars { font-size: 1.5em; color: #ffc107; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">
            Figure 6.10 - Interface SHAP Conversationnelle Appr√©ci√©e Utilisateurs
        </h1>
        
        <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #28a745;">
            <h4 style="color: #28a745; margin-top: 0;">üí¨ Interface XAI R√©volutionnaire - Cas d'Usage R√©el</h4>
            <p style="margin-bottom: 0;">
                <strong>Sc√©nario</strong> : Exploitant nuit d√©tecte anomalie pH. L'IA explicable guide l'analyse et la r√©solution 
                avec des explications contextualis√©es m√©tier en <strong>langage naturel + visualisations SHAP</strong>.
            </p>
        </div>

        <div class="interface-demo">
            <h3 style="margin-top: 0;">üñ•Ô∏è Interface Temps R√©el - Station Saint-Quentin-Fallavier</h3>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div>
                    <h4>üí¨ Chatbot IA Explicable - Session 03/08/2024 23:42</h4>
                    <div class="chat-container">
                        <div class="message ai-message">
                            <strong>ü§ñ AssistantEau AI</strong><br>
                            ‚ö†Ô∏è <strong>ALERTE D√âTECT√âE</strong> - D√©rive pH Bassin B2<br>
                            Valeur actuelle: <strong>6.2 pH</strong> (seuil: 6.5-8.5)<br>
                            Confiance pr√©diction: <strong>94.7%</strong>
                        </div>
                        
                        <div class="message user-message">
                            <strong>üë®‚Äçüîß Marc (Exploitant Nuit)</strong><br>
                            Pourquoi cette alerte maintenant ? Les autres param√®tres semblent OK
                        </div>
                        
                        <div class="message ai-message">
                            <strong>ü§ñ AssistantEau AI</strong><br>
                            Excellente question Marc ! Voici l'analyse SHAP d√©taill√©e :<br><br>
                            
                            <div class="shap-explanation">
                                <strong>üìä Facteurs Influen√ßant la Pr√©diction :</strong><br>
                                üî¥ <strong>D√©bit entrant</strong> : +1.85 (surcharge +34%)<br>
                                üî¥ <strong>Temp√©rature</strong> : +0.92 (4¬∞C au-dessus normale)<br>
                                üü° <strong>O2 dissous</strong> : +0.43 (l√©g√®re baisse activit√©)<br>
                                üü¢ <strong>Conductivit√©</strong> : -0.12 (stable, bon signe)<br>
                                üü¢ <strong>Turbidit√©</strong> : -0.08 (dans les normes)
                            </div>
                            
                            La <strong>surcharge hydraulique</strong> combin√©e √† la <strong>temp√©rature √©lev√©e</strong> acc√©l√®re la consommation d'oxyg√®ne et ralentit la nitrification, d'o√π la baisse du pH.
                        </div>
                        
                        <div class="message user-message">
                            <strong>üë®‚Äçüîß Marc</strong><br>
                            D'accord, que me conseilles-tu comme action ?
                        </div>
                        
                        <div class="message ai-message">
                            <strong>ü§ñ AssistantEau AI</strong><br>
                            <strong>üéØ Actions Recommand√©es (par ordre de priorit√©) :</strong><br><br>
                            
                            1. <strong>IMM√âDIAT</strong> - Augmenter a√©ration B2 : +15% d√©bit air<br>
                            2. <strong>5 min</strong> - R√©partir charge : r√©duire arriv√©e B2, augmenter B1/B3<br>
                            3. <strong>10 min</strong> - Surveiller √©volution : pH devrait remonter vers 6.8<br><br>
                            
                            <strong>üí° Pr√©diction :</strong> Avec ces actions, retour pH normal en <strong>47 minutes</strong> (confiance: 89%)
                        </div>
                        
                        <div class="message user-message">
                            <strong>üë®‚Äçüîß Marc</strong><br>
                            Parfait ! Actions lanc√©es. Peux-tu expliquer pourquoi l'a√©ration aide ?
                        </div>
                        
                        <div class="message ai-message">
                            <strong>ü§ñ AssistantEau AI</strong><br>
                            <strong>üß¨ Explication Biologique :</strong><br><br>
                            
                            L'augmentation d'a√©ration favorise :<br>
                            ‚Ä¢ <strong>Nitrification</strong> : NH4+ ‚Üí NO2- ‚Üí NO3- (consomme H+)<br>
                            ‚Ä¢ <strong>Activit√© bact√©rienne</strong> : plus d'O2 = meilleur rendement<br>
                            ‚Ä¢ <strong>Homog√©n√©isation</strong> : √©vite les zones mortes<br><br>
                            
                            R√©sultat : <strong>pH remonte naturellement</strong> gr√¢ce aux bact√©ries nitrifiantes ! ü¶†‚ú®
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4>üìä Param√®tres Temps R√©el</h4>
                    <div class="parameter-grid">
                        <div class="parameter-card param-critical">
                            <strong>pH Bassin B2</strong><br>
                            <div class="shap-value negative-impact">6.2 pH</div>
                            <small>Seuil: 6.5-8.5</small>
                        </div>
                        <div class="parameter-card param-warning">
                            <strong>D√©bit Entrant</strong><br>
                            <div class="shap-value negative-impact">2,347 m¬≥/h</div>
                            <small>Nominal: 1,750 m¬≥/h</small>
                        </div>
                        <div class="parameter-card param-warning">
                            <strong>Temp√©rature</strong><br>
                            <div class="shap-value negative-impact">22.4¬∞C</div>
                            <small>Moyenne: 18.2¬∞C</small>
                        </div>
                        <div class="parameter-card param-normal">
                            <strong>O2 Dissous</strong><br>
                            <div class="shap-value positive-impact">5.8 mg/L</div>
                            <small>Objectif: >4.0 mg/L</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h3 style="text-align: center;">Graphique SHAP - Contribution Param√®tres (Temps R√©el)</h3>
        <div class="chart-container">
            <canvas id="shapChart"></canvas>
        </div>

        <h3 style="text-align: center;">√âvolution Pr√©dite vs R√©elle (Post-Action)</h3>
        <div class="chart-container">
            <canvas id="predictionChart"></canvas>
        </div>

        <div class="feedback-section">
            <h4 style="color: #28a745; margin-top: 0;">üìù Retour Utilisateur - Marc D. (Exploitant Nuit, 12 ans d'exp√©rience)</h4>
            
            <div class="satisfaction-stars">
                ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê <strong>9.2/10</strong> - Satisfaction Interface XAI
            </div>
            
            <blockquote style="border-left: 4px solid #28a745; padding-left: 15px; margin: 15px 0; font-style: italic;">
                "Pour la premi√®re fois, je comprends <strong>pourquoi</strong> l'IA me propose telle action. 
                Les explications SHAP me rappellent mon formation initiale mais avec des donn√©es concr√®tes. 
                C'est comme avoir un coll√®gue expert qui m'explique en temps r√©el !"
            </blockquote>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h5>üëç Points Appr√©ci√©s</h5>
                    <ul>
                        <li>Langage m√©tier accessible</li>
                        <li>Explications causales claires</li>
                        <li>Actions concr√®tes prioritaires</li>
                        <li>Pr√©dictions avec confiance</li>
                        <li>Interface conversationnelle</li>
                    </ul>
                </div>
                <div>
                    <h5>üí° Suggestions Am√©lioration</h5>
                    <ul>
                        <li>Historique conversations 30j</li>
                        <li>Mode vocal pour terrain</li>
                        <li>Int√©gration planning maintenance</li>
                        <li>Alertes smartphone personnalis√©es</li>
                        <li>Formation adaptative continue</li>
                    </ul>
                </div>
            </div>
        </div>

        <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 30px 0;">
            <h4 style="color: #1976d2; margin-top: 0;">üìä Impact Mesurable Interface XAI</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h5>Performance Op√©rationnelle</h5>
                    <ul>
                        <li><strong>Temps r√©solution</strong> : 47min vs 3.2h avant XAI</li>
                        <li><strong>Pr√©cision diagnostic</strong> : 94.7% vs 67% intuition</li>
                        <li><strong>Actions correctives</strong> : 1√®re tentative vs 2.3 essais</li>
                        <li><strong>Formation acc√©l√©r√©e</strong> : 15j vs 45j traditionnel</li>
                    </ul>
                </div>
                <div>
                    <h5>Satisfaction Utilisateur</h5>
                    <ul>
                        <li><strong>Compr√©hension IA</strong> : 9.2/10 vs 3.1/10 opaque</li>
                        <li><strong>Confiance d√©cisions</strong> : 8.7/10 vs 4.2/10 avant</li>
                        <li><strong>Adoption quotidienne</strong> : 91% vs 34% solutions legacy</li>
                        <li><strong>Recommandation coll√®gues</strong> : 89% utilisateurs</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Graphique SHAP contributions
        const ctx1 = document.getElementById('shapChart').getContext('2d');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['D√©bit Entrant', 'Temp√©rature', 'O2 Dissous', 'Conductivit√©', 'Turbidit√©', 'Historique pH'],
                datasets: [{
                    label: 'Contribution SHAP',
                    data: [1.85, 0.92, 0.43, -0.12, -0.08, 0.34],
                    backgroundColor: function(context) {
                        const value = context.parsed.y;
                        if (value > 1) return '#dc3545';
                        if (value > 0.5) return '#fd7e14';
                        if (value > 0) return '#ffc107';
                        return '#28a745';
                    },
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.parsed.x;
                                const impact = value > 0 ? 'augmente' : 'diminue';
                                return `${context.label}: ${impact} risque de ${Math.abs(value).toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Contribution √† la Pr√©diction' },
                        grid: { color: '#e9ecef' }
                    }
                }
            }
        });

        // Graphique pr√©diction vs r√©alit√©
        const ctx2 = document.getElementById('predictionChart').getContext('2d');
        new Chart(ctx2, {
            type: 'line',
            data: {
                labels: ['23:42', '23:47', '23:52', '23:57', '00:02', '00:07', '00:12', '00:17', '00:22', '00:27', '00:32'],
                datasets: [{
                    label: 'pH Pr√©dit (IA)',
                    data: [6.2, 6.25, 6.35, 6.48, 6.62, 6.74, 6.83, 6.89, 6.92, 6.94, 6.95],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.1,
                    borderDash: [5, 5]
                }, {
                    label: 'pH R√©el (Capteur)',
                    data: [6.2, 6.24, 6.33, 6.45, 6.59, 6.71, 6.81, 6.87, 6.91, 6.93, 6.94],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.1,
                    fill: true
                }, {
                    label: 'Seuil Minimum',
                    data: [6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5],
                    borderColor: '#dc3545',
                    borderDash: [10, 5],
                    tension: 0,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return `Heure: ${context[0].label}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'pH' },
                        min: 6.0,
                        max: 7.0,
                        ticks: { stepSize: 0.1 }
                    }
                }
            }
        });
    </script>
</body>
</html>